name: Generate Animated Snake

on:
  workflow_dispatch:

jobs:
  generate-animated-snake:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install axios fs-extra

      - name: Generate animated snake.svg
        run: |
          mkdir -p dist
          cat << 'EOF' > snake-temp.js
const fs = require("fs-extra");
const axios = require("axios");
const username = "Flarxx";
const distPath = "./dist/snake.svg";

(async () => {
  const html = (await axios.get("https://github.com/users/"+username+"/contributions")).data;
  const rects = html.match(/<rect .*?\/>/g) || [];
  let animatedRects = rects.map((r, i) => r.replace("/>", " style='animation: show 0.1s forwards "+(i*0.05)+"s;'/>"));
  let svgContent = `<svg xmlns="http://www.w3.org/2000/svg" width="800" height="110">
<style>
@keyframes show { from {opacity:0;} to {opacity:1;} }
</style>
${animatedRects.join("\n")}
</svg>`;
  await fs.writeFile(distPath, svgContent, "utf8");
  console.log("Animated snake.svg generado!");
})();
EOF
          node snake-temp.js

      - name: Deploy to output branch
        uses: peaceiris/actions-gh-pages@v3.9.2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: output


